/* automatically generated by JSCoverage - do not edit */
if (typeof _$jscoverage === 'undefined') _$jscoverage = {};
if (! _$jscoverage['util.js']) {
  _$jscoverage['util.js'] = [];
  _$jscoverage['util.js'][1] = 0;
  _$jscoverage['util.js'][11] = 0;
  _$jscoverage['util.js'][12] = 0;
  _$jscoverage['util.js'][14] = 0;
  _$jscoverage['util.js'][15] = 0;
  _$jscoverage['util.js'][18] = 0;
  _$jscoverage['util.js'][19] = 0;
  _$jscoverage['util.js'][20] = 0;
  _$jscoverage['util.js'][23] = 0;
  _$jscoverage['util.js'][33] = 0;
  _$jscoverage['util.js'][34] = 0;
  _$jscoverage['util.js'][40] = 0;
  _$jscoverage['util.js'][43] = 0;
  _$jscoverage['util.js'][44] = 0;
  _$jscoverage['util.js'][48] = 0;
  _$jscoverage['util.js'][49] = 0;
  _$jscoverage['util.js'][52] = 0;
  _$jscoverage['util.js'][62] = 0;
  _$jscoverage['util.js'][63] = 0;
  _$jscoverage['util.js'][65] = 0;
  _$jscoverage['util.js'][66] = 0;
  _$jscoverage['util.js'][67] = 0;
  _$jscoverage['util.js'][71] = 0;
  _$jscoverage['util.js'][80] = 0;
  _$jscoverage['util.js'][81] = 0;
  _$jscoverage['util.js'][83] = 0;
  _$jscoverage['util.js'][84] = 0;
  _$jscoverage['util.js'][85] = 0;
  _$jscoverage['util.js'][89] = 0;
  _$jscoverage['util.js'][99] = 0;
  _$jscoverage['util.js'][100] = 0;
  _$jscoverage['util.js'][104] = 0;
  _$jscoverage['util.js'][105] = 0;
  _$jscoverage['util.js'][108] = 0;
  _$jscoverage['util.js'][109] = 0;
  _$jscoverage['util.js'][110] = 0;
  _$jscoverage['util.js'][111] = 0;
  _$jscoverage['util.js'][112] = 0;
  _$jscoverage['util.js'][114] = 0;
  _$jscoverage['util.js'][117] = 0;
  _$jscoverage['util.js'][135] = 0;
  _$jscoverage['util.js'][136] = 0;
  _$jscoverage['util.js'][141] = 0;
  _$jscoverage['util.js'][142] = 0;
  _$jscoverage['util.js'][145] = 0;
  _$jscoverage['util.js'][146] = 0;
  _$jscoverage['util.js'][147] = 0;
  _$jscoverage['util.js'][148] = 0;
  _$jscoverage['util.js'][149] = 0;
  _$jscoverage['util.js'][150] = 0;
  _$jscoverage['util.js'][152] = 0;
  _$jscoverage['util.js'][154] = 0;
  _$jscoverage['util.js'][156] = 0;
  _$jscoverage['util.js'][159] = 0;
  _$jscoverage['util.js'][163] = 0;
  _$jscoverage['util.js'][166] = 0;
}
_$jscoverage['util.js'][1]++;
var rxNumber = /^\s*\d+\s*$/, me = {DEFAULT_LIMIT: 1000};
_$jscoverage['util.js'][11]++;
me.extend = (function (obj) {
  _$jscoverage['util.js'][12]++;
  var args = Array.prototype.slice.call(arguments, 1);
  _$jscoverage['util.js'][14]++;
  if (! obj) {
    _$jscoverage['util.js'][15]++;
    return obj;
  }
  _$jscoverage['util.js'][18]++;
  args.forEach((function (source) {
  _$jscoverage['util.js'][19]++;
  for (var prop in source) {
    _$jscoverage['util.js'][20]++;
    obj[prop] = source[prop];
}
}));
  _$jscoverage['util.js'][23]++;
  return obj;
});
_$jscoverage['util.js'][33]++;
me.buildOptionsObject = (function (qs) {
  _$jscoverage['util.js'][34]++;
  var opts = {}, limit = me.getLimitValue(qs), skip = me.getSkipValue(qs), sort = me.getSortObject(qs);
  _$jscoverage['util.js'][40]++;
  opts.limit = limit;
  _$jscoverage['util.js'][43]++;
  if (skip) {
    _$jscoverage['util.js'][44]++;
    opts.skip = skip;
  }
  _$jscoverage['util.js'][48]++;
  if (sort) {
    _$jscoverage['util.js'][49]++;
    opts.sort = sort;
  }
  _$jscoverage['util.js'][52]++;
  return opts;
});
_$jscoverage['util.js'][62]++;
me.getSkipValue = (function (qs) {
  _$jscoverage['util.js'][63]++;
  var val;
  _$jscoverage['util.js'][65]++;
  if (qs && qs.skip) {
    _$jscoverage['util.js'][66]++;
    if (rxNumber.test(qs.skip)) {
      _$jscoverage['util.js'][67]++;
      val = parseInt(qs.skip, 10);
    }
  }
  _$jscoverage['util.js'][71]++;
  return val;
});
_$jscoverage['util.js'][80]++;
me.getLimitValue = (function (qs) {
  _$jscoverage['util.js'][81]++;
  var val;
  _$jscoverage['util.js'][83]++;
  if (qs && qs.limit) {
    _$jscoverage['util.js'][84]++;
    if (rxNumber.test(qs.limit)) {
      _$jscoverage['util.js'][85]++;
      val = Math.min(parseInt(qs.limit, 10), me.DEFAULT_LIMIT);
    }
  }
  _$jscoverage['util.js'][89]++;
  return val || me.DEFAULT_LIMIT;
});
_$jscoverage['util.js'][99]++;
me.getSortObject = (function (qs) {
  _$jscoverage['util.js'][100]++;
  var sort = {}, vals, val;
  _$jscoverage['util.js'][104]++;
  if (! qs || ! qs.sort) {
    _$jscoverage['util.js'][105]++;
    return null;
  }
  _$jscoverage['util.js'][108]++;
  vals = qs.sort.split(",");
  _$jscoverage['util.js'][109]++;
  for (var i = 0; i < vals.length; i++) {
    _$jscoverage['util.js'][110]++;
    val = vals[i].trim();
    _$jscoverage['util.js'][111]++;
    if (val.substr(0, 1) === "-") {
      _$jscoverage['util.js'][112]++;
      sort[val.substr(1)] = -1;
    }
    else {
      _$jscoverage['util.js'][114]++;
      sort[val] = 1;
    }
}
  _$jscoverage['util.js'][117]++;
  return sort;
});
_$jscoverage['util.js'][135]++;
me.normalizeCriteria = (function (crit, specs) {
  _$jscoverage['util.js'][136]++;
  var res = {}, val, falseVals, trueVals;
  _$jscoverage['util.js'][141]++;
  if (! crit || ! specs) {
    _$jscoverage['util.js'][142]++;
    return null;
  }
  _$jscoverage['util.js'][145]++;
  for (var key in specs) {
    _$jscoverage['util.js'][146]++;
    val = crit[key];
    _$jscoverage['util.js'][147]++;
    if (typeof val !== "undefined") {
      _$jscoverage['util.js'][148]++;
      if (specs[key].isBoolean) {
        _$jscoverage['util.js'][149]++;
        trueVals = specs[key].trueValues || ["true", "1"];
        _$jscoverage['util.js'][150]++;
        falseVals = specs[key].falseValues;
        _$jscoverage['util.js'][152]++;
        val = (falseVals && falseVals.length? falseVals.indexOf(val) < 0: trueVals.indexOf(val) >= 0);
      }
      _$jscoverage['util.js'][154]++;
      if (specs[key].mapTo) {
        _$jscoverage['util.js'][156]++;
        res[specs[key].mapTo] = (specs[key].isBoolean && specs[key].mapReverseValue? ! val: val);
      }
      else {
        _$jscoverage['util.js'][159]++;
        res[key] = val;
      }
    }
}
  _$jscoverage['util.js'][163]++;
  return res;
});
_$jscoverage['util.js'][166]++;
module.exports = me;
_$jscoverage['util.js'].source = ["var rxNumber = /^\\s*\\d+\\s*$/,","  me = {DEFAULT_LIMIT: 1000}","","/*","** extend(target, src1, src2, ...)","**","** Extend a given object by copying each property of the following object(s) to it.","** The last object in the list wins if there is a name conflict. This is more or less","** the same as Underscore extend().","*/","me.extend = function(obj) {","  var args = Array.prototype.slice.call(arguments, 1)","","  if (!obj) {","    return obj","  }","","  args.forEach(function(source) {","    for (var prop in source) {","      obj[prop] = source[prop]","    }","  })","  return obj","}","","/*","** buildOptionsObject(qs)","**","** Takes a parsed query string object, and builds a full options object, with","** the sort criteria, the limit value, and the skip value, ready to be used","** by db.collection.find().","*/","me.buildOptionsObject = function(qs) {","  var opts = {},","    limit = me.getLimitValue(qs),","    skip = me.getSkipValue(qs),","    sort = me.getSortObject(qs)","","  // Limit is always present","  opts.limit = limit","","  // Skip is present only if != 0","  if (skip) {","    opts.skip = skip","  }","","  // Sort is present only if specified in query string","  if (sort) {","    opts.sort = sort","  }","","  return opts","}","","/*","** getSkipValue(qs)","**","** Takes a parsed query string object, and looks for a \"skip\" key. If there is one, and it is","** a valid number, then it uses this value as the number of objects to skip before starting","** to return documents.","*/","me.getSkipValue = function(qs) {","  var val","","  if (qs &amp;&amp; qs.skip) {","    if (rxNumber.test(qs.skip)) {","      val = parseInt(qs.skip, 10)","    }","  }","","  return val","}","","/*","** getLimitValue(qs)","**","** Takes a parsed query string object, and looks for a \"limit\" key. If there is one, and it is","** a valid number, then it uses this value as the limit of objects returned.","*/","me.getLimitValue = function(qs) {","  var val","","  if (qs &amp;&amp; qs.limit) {","    if (rxNumber.test(qs.limit)) {","      val = Math.min(parseInt(qs.limit, 10), me.DEFAULT_LIMIT)","    }","  }","","  return val || me.DEFAULT_LIMIT","}","","/*","** getSortObject(qs)","**","** Takes a parsed query string object, and looks for a \"sort\" key. If there is one, then a sort","** object will be returned. Sort fields are specified as a comma-separated list of fields, and","** a descending sort may be specified by prefixing the field with a minus (-).","*/","me.getSortObject = function(qs) {","  var sort = {},","    vals,","    val","","  if (!qs || !qs.sort) {","    return null","  }","","  vals = qs.sort.split(',')","  for (var i = 0; i &lt; vals.length; i++) {","    val = vals[i].trim()","    if (val.substr(0, 1) === '-') {","      sort[val.substr(1)] = -1","    } else {","      sort[val] = 1","    }","  }","  return sort","}","","/*","** normalizeCriteria()","**","** Take a criteria object (typically, a parsed query string object) and a specifications object","** and whitelists criteria according to the specs.","**","** specs format:","** key: name of a field to act upon","** value: either a boolean (true: allow, false: ignore) or an object:","**   - isBoolean: true if the criterion is a boolean","**   - trueValues: array of values to be considered true (strings), defaults to ['true', '1']","**   - falseValues: array of values to be considered false (strings), defaults to null (uses trueValues)","**   - mapTo: name of a key to use instead of this key (ex.: \"a\" provided as a shorthand for \"active\")","**   - mapReverseValue: boolean. In the case of a boolean value, maps to \"mapTo\" and reverses the boolean value (true&lt;-&gt;false)","*/","me.normalizeCriteria = function(crit, specs) {","  var res = {},","    val,","    falseVals,","    trueVals","","  if (!crit || !specs) {","    return null","  }","","  for (var key in specs) {","    val = crit[key]","    if (typeof val !== 'undefined') {","      if (specs[key].isBoolean) {","        trueVals = specs[key].trueValues || ['true', '1']","        falseVals = specs[key].falseValues","","        val = (falseVals &amp;&amp; falseVals.length ? falseVals.indexOf(val) &lt; 0 : trueVals.indexOf(val) &gt;= 0)","      }","      if (specs[key].mapTo) {","        // Override res[key], no matter if something was present. Do not send incoherent criteria.","        res[specs[key].mapTo] = (specs[key].isBoolean &amp;&amp; specs[key].mapReverseValue ? !val : val)","      } else {","        // Set the key as is on the result object","        res[key] = val","      }","    }","  }","  return res","}","","module.exports = me"];
